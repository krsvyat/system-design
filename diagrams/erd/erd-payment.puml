@startuml erd-payment
hide circle

entity "payments" {
  * payment_id : uuid <<PK>>
  --
  * wallet_id : uuid
  * provider_txn_id : text
  * amount : bigint
  * currency : text
  * status : text
  * error_code : text
  * created_at : timestamptz
  * updated_at : timestamptz
  * timeout_at : timestamptz
  * retry_count : int
  --
  <<CHECK>> amount > 0
  <<CHECK>> status IN ('PROCESSING', 'COMPLETED', 'FAILED')
  --
  <<INDEX>> idx_payments_provider_txn_id (provider_txn_id)
}

entity "payment_outbox" {
  * id : uuid <<PK>>
  --
  * payment_id : uuid
  * event_type : text
  * payload : jsonb
  * created_at : timestamptz
  * published_at : timestamptz
}

@enduml
