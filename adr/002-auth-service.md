# ADR-002: Свой Auth Service вместо Keycloak

## Статус

Принято

## Контекст

Нужна аутентификация для мобильного и веб-приложения. Варианты:

1. **Keycloak** — open source IdP, OIDC/OAuth2 из коробки
2. **Свой Auth Service** — собственная реализация

## Решение

Делаем свой Auth Service.

## Обоснование

У банкинга специфичные требования, которые Keycloak плохо поддерживает:

| Требование                | Keycloak             | Свой сервис             |
| ------------------------- | -------------------- | ----------------------- |
| Интеграция с ЕСИА         | Не поддерживается    | Своя интеграция         |
| SMS OTP коды              | Плагин, ограничен    | Полный контроль         |
| Push подтверждение        | Сложно интегрировать | Нативная поддержка      |
| Fraud-проверка при логине | Отдельная система    | Интеграция с Anti-Fraud |
| Кастомный аудит           | Стандартный формат   | Наш формат              |

Keycloak заточен под корпоративный SSO. Банкинг требует:

- Логин по номеру телефона (не email)
- Несколько методов MFA
- Интеграция с регуляторными системами
- Кастомные правила сессий

Auth Service вызывает Anti-Fraud при каждом логине (sync gRPC) для проверки подозрительной активности (новое устройство, необычная локация).

## Последствия

**Положительные:**

- Полный контроль над auth flow
- Простая интеграция с банковскими системами
- Нет зависимости от внешнего продукта

**Отрицательные:**

- Больше разработки
- Ответственность за безопасность на нас
