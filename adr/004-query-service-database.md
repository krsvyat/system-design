# ADR-004: PostgreSQL для Query Service Read Model

## Статус

Принято

## Контекст

Query Service реализует read-сторону CQRS. Консьюмит события из Kafka (PaymentInitiated, PaymentCompleted, PaymentFailed) и строит денормализованные проекции для запросов.

Требования:

- Быстрый поиск статуса платежа по ID
- Список платежей по пользователю с фильтрами и пагинацией
- История операций с фильтром по датам
- Eventual consistency допустима

## Решение

Используем **PostgreSQL** для read model Query Service.

### Почему PostgreSQL

- **OLTP нагрузка**: запросы — lookup по ID и списки по user_id, PostgreSQL справляется с индексами
- **Команда знает**: уже используется для Wallet/Payment DB
- **Богатые возможности**: SQL агрегаты, joins если нужно

### Рассмотренные варианты

| Вариант           | Почему нет                                                                |
| ----------------- | ------------------------------------------------------------------------- |
| **Elasticsearch** | Заточен под full-text search, overkill для простых lookup по ID/user_id   |
| **ClickHouse**    | OLAP база для аналитики (агрегации по миллионам строк), наши запросы OLTP |

## Последствия

**Положительные:**

- Единый технологический стек (все сервисы на PostgreSQL)
- Богатые возможности запросов из коробки
