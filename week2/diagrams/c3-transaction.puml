@startuml c3-transaction
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Transaction Service - Component Diagram (C3)

ContainerQueue(kafka, "Kafka", "", "")
ContainerDb(db, "Transaction DB", "PostgreSQL", "")
System_Ext(provider, "Payment Provider", "")

Container_Boundary(transaction, "Transaction Service") {
    Component(event_handler, "Event Handler", "Kafka Listener", "Handles PaymentInitiated, ProviderCallbackReceived")
    Component(command, "Command Handler", "Service", "Business logic, state transitions")
    Component(provider_client, "Provider Client", "HTTP Client", "Calls external payment provider")
}

' Kafka -> Transaction
Rel_D(kafka, event_handler, "PaymentInitiated, ProviderCallbackReceived")

' Internal flow
Rel_D(event_handler, command, "calls")
Rel_D(command, provider_client, "initiatePayment")
Rel_D(command, db, "writes payment state + outbox")

' Provider integration
Rel_D(provider_client, provider, "HTTPS", "initiatePayment")

SHOW_LEGEND()

@enduml
