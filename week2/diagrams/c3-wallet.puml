@startuml c3-wallet
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Wallet Service - Component Diagram (C3)

Container(bff, "BFF", "", "")
ContainerQueue(kafka, "Kafka", "", "")
ContainerDb(db, "Wallet DB", "PostgreSQL", "")
Container(kafka_connect, "Kafka Connect", "Debezium", "")

Container_Boundary(wallet, "Wallet Service") {
    Component(api, "API Controller", "REST", "HTTP endpoints")
    Component(command, "Command Handler", "Service", "reserveFunds, commitFunds, releaseFunds")
    Component(event_handler, "Event Handler", "Kafka Listener", "Handles PaymentCompleted, PaymentFailed")
}

' External -> Wallet
Rel_D(bff, api, "HTTP", "reserveFunds")
Rel_D(api, command, "calls")

' Internal flow
Rel_D(command, db, "writes transaction + outbox")
Rel_D(event_handler, command, "commitFunds / releaseFunds")

' Kafka integration
Rel_L(kafka, event_handler, "PaymentCompleted, PaymentFailed")

' CDC
Rel_U(kafka_connect, db, "reads WAL")
Rel_U(kafka_connect, kafka, "PaymentInitiated")

SHOW_LEGEND()

@enduml
