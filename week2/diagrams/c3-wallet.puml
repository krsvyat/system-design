@startuml c3_wallet
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Wallet Service - Component Diagram (C3)

Container(bff, "BFF", "", "")
ContainerQueue(kafka, "Kafka", "", "")
ContainerDb(db, "Wallet DB", "PostgreSQL", "")

Container_Boundary(wallet, "Wallet Service") {
    Component(api, "API Controller", "REST", "HTTP endpoints")
    Component(command, "Command Handler", "Service", "reserveFunds, commitFunds, releaseFunds")
    Component(event_handler, "Event Handler", "Kafka Listener", "Handles PaymentCompleted, PaymentFailed")
    Component(outbox_publisher, "Outbox Publisher", "Polling / Debezium", "Publishes events to Kafka")
}

' External -> Wallet
Rel_D(bff, api, "HTTP", "reserveFunds")
Rel_D(api, command, "calls")

' Internal flow
Rel_D(command, db, "writes transaction + outbox")
Rel_D(event_handler, command, "commitFunds / releaseFunds")
Rel_U(outbox_publisher, db, "reads outbox")

' Kafka integration
Rel_R(outbox_publisher, kafka, "PaymentInitiated")
Rel_L(kafka, event_handler, "PaymentCompleted, PaymentFailed")

SHOW_LEGEND()

@enduml
